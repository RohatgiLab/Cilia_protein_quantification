This folder contains the scripts to quantify proteins, such as Smoothened and Patched1, which are not always localized to one specific area of the cilia. Therefore, the quantification from these scripts is a bulk measurement of the protein-of-interest (POI) in the cilia. These scripts were developed in MATLAB and have been tested with MATLAB versions 2014a and 2014b.

The “ciliaFinder.m” script is the main script that combines the functions defined in the other three scripts: “get_max_z_projections.m,” “quant_cilia_for_field.m,” and “snapShots.m”. To quantify cilia and the ciliary proteins, you will need to run “ciliaFinder.m”. Some steps need to be taken before you can quantify the POI in your cilia with “ciliaFinder.m”:

1. You will need to download the “bfmatlab” toolbox from the following link: https://docs.openmicroscopy.org/bio-formats/5.7.0/users/matlab/ . This toolbox is used to read in the Leica Image File (LIF). In the “get_max_z_projections.m” script, you will need to add the path to the “bfmatlab” toolbox by replacing the text in the “addpath” function in line 8 and saving the file.
2. Within “ciliaFinder.m,” you will need to specify the path to the directory holding the scripts from the "cilia_SMO_quantification" folder in “cd” function in line 2. In addition, please provide the path to the LIF in the “leicaFile” variable in line 19.
3. Also within “ciliaFinder.m,” you will need to specify the order in which the images for the DAPI staining, cilia-marker staining, and POI staining were taken. Please change “PARAMS.dapiNum” to specify the position of the DAPI channel images in the LIF. Please change “PARAMS.ciliaNum” to specify the position of the cilia-marker channel images in the LIF. Please change “PARAMS.targetNum” to specify the position of the POI channel images in the LIF.
4. Additionally within “ciliaFinder.m,” you will need to specify the number of fields captured in the LIF and the number of markers/stainings imaged. Please change “PARAMS.numFields” to specify the number of fields captured in the LIF. Please change “PARAMS.numMarkers” to specify the number of markers/stainings imaged in the LIF; this number should most likely be no less than 3 because you should have a DAPI staining, cilia-marker staining, and POI staining.
5. Depending on your your cell line, image resolution, and staining efficiency, you will also need to tune the values of the variables “PARAMS.Threshold,” “PARAMS.MinMax,” “PARAMS.MinArea,” “PARAMS.MaxArea,” “PARAMS.MinEccentricity,” and “PARAMS.perimeterThres”. The definitions of these variables is defined in the methodology below.


The following is a description of steps taken to quantify the ciliary POI:
The LIF is converted into matrices using the bfmatlab toolbox. A max-z-projection is performed for each set of planes in a given field, followed by quantification of the cilia and POI through the following steps. First, a two-dimensional median filter is applied to the cilia channel to remove fine noise, followed by a high-pass user-defined threshold (defined as “PARAMS.Threshold” in “ciliaFinder.m”) for signal versus noise to generate a cilia mask in the cilia channel. Any group of contiguous pixels that has signal is labeled as a “potential cilium” and measured for area, eccentricity, solidity, intensity, and length. If the “potential cilium” does not meet the static threshold for solidity (a measure of the ratio of the number of pixels with signal for the “potential cilium” in the cilia-marker channel to the number of pixels without signal for the same “potential cilium”), it is discarded from the dataset; if the “potential cilium” does not meet the user-defined thresholds for minimum eccentricity (stored as “PARAMS.MinEccentricity” in “ciliaFinder.m”), minimum and maximum area (defined as “PARAMS.MinArea” and “PARAMS.MaxArea” respectively in “ciliaFinder.m”), or minimum intensity (defined as “PARAMS.MinMax” in “ciliaFinder.m”), it was also discarded. Additionally, if the “potential cilium” is within a user-defined distance of another “potential cilium” (defined as “PARAMS.perimeterThres” in “ciliaFinder.m”), then it is also discarded to avoid misquantification of false positives arising from non-specific cilia staining. If a “potential cilium” meets these tests, each pixel that composes the cilium is noted and mapped to the matrix that holds the intensity values for the POI channel.
To generate the final intensity value for the POI, the mean intensity of the pixels mapping to the POI channel is calculated, and then a background correction is performed. The method chosen for background correction is to calculate the average intensity in a 100x100 pixel grid around each pixel in the POI channel, followed by subtraction from the mean intensity. The final, POI intensity value for each identified cilium is recorded along with the area and length of the cilium. Lastly, TIFF files for the DAPI channel, cilia channel, and POI channel for each field are saved, and snapshots of the chosen cilia and the POI in the chosen cilia for each saved.