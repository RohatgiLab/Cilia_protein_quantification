This folder contains the scripts to quantify proteins, such as Gli2 or Iqce, which are often localized to a specific area of the cilia. The quantification from these scripts is a defined measurement of the protein-of-interest (POI) in the cilia. These scripts were developed in MATLAB and have been tested with MATLAB versions 2014a and 2014b.

The “ciliaFinder_Gli2.m” script is the main script that combines the functions defined in the other two scripts: “get_max_z_projections.m” and “quant_Gli2_for_field.m.” To quantify cilia and the ciliary proteins, you will need to run “ciliaFinder_Gli2.m”. Some steps need to be taken before you can quantify the POI in your cilia with “ciliaFinder_Gli2.m”:

1. You will need to download the “bfmatlab” toolbox from the following link: “https://docs.openmicroscopy.org/bio-formats/5.7.0/users/matlab/“. This toolbox is used to read in the Leica Image File (LIF). In the “get_max_z_projections.m” script, you will need to add the path to the “bfmatlab” toolbox by replacing the text in the “addpath” function in line 8 and saving the file.
2. Within “ciliaFinder_Gli2.m,” you will need to specify the path to the directory holding the scripts from the "cilia_Gli2_quantification" folder in the “cd” function in line 2. In addition, please provide the path to the LIF in the “leicaFile” variable in line 19.
3. Also within “ciliaFinder_Gli2.m,” you will need to specify the order in which the images for the DAPI staining, cilia-marker staining, and POI staining were taken. Please change “PARAMS.dapiNum” to specify the position of the DAPI channel images in the LIF. Please change “PARAMS.ciliaNum” to specify the position of the cilia-marker channel images in the LIF. Please change “PARAMS.targetNum” to specify the position of the POI channel images in the LIF.
4. Additionally within “ciliaFinder_Gli2.m,” you will need to specify the number of fields captured in the LIF and the number of markers/stainings imaged. Please change “PARAMS.numFields” to specify the number of fields captured in the LIF. Please change “PARAMS.numMarkers” to specify the number of markers/stainings imaged in the LIF; this number should most likely be no less than 3 because you should have a DAPI staining, cilia-marker staining, and POI staining.
5. Depending on your your cell line, image resolution, and staining efficiency, you will also need to tune the values of the variables “PARAMS.Threshold,” “PARAMS.MinMax,” “PARAMS.MinArea,” “PARAMS.MaxArea,” “PARAMS.MinEccentricity,” “PARAMS.perimeterThres,” and “PARAMS.TargetProtThreshold”. The definitions of these variables is defined in the methodology below.


The following is a description of steps taken to quantify the ciliary POI:
The LIF is converted into matrices using the bfmatlab toolbox. A max-z-projection is performed for each set of planes in a given field, followed by quantification of the cilia and POI through the following steps. First, a two-dimensional median filter is applied to the cilia channel to remove fine noise, followed by a high-pass user-defined threshold (defined as “PARAMS.Threshold” in “ciliaFinder_Gli2.m”) for signal versus noise to generate a cilia mask in the cilia channel. Any group of contiguous pixels that has signal is labeled as a “potential cilium” and measured for area, eccentricity, solidity, intensity, and length. If the “potential cilium” does not meet the static threshold for solidity (a measure of the ratio of the number of pixels with signal for the “potential cilium” in the cilia-marker channel to the number of pixels without signal for the same “potential cilium”), it is discarded from the dataset; if the “potential cilium” does not meet the user-defined thresholds for minimum eccentricity (stored as “PARAMS.MinEccentricity” in “ciliaFinder_Gli2.m”), minimum and maximum area (defined as “PARAMS.MinArea” and “PARAMS.MaxArea” respectively in “ciliaFinder_Gli2.m”), or minimum intensity (defined as “PARAMS.MinMax” in “ciliaFinder_Gli2.m”), it was also discarded. Additionally, if the “potential cilium” is within a user-defined distance of another “potential cilium” (defined as “PARAMS.perimeterThres” in “ciliaFinder_Gli2.m”), then it is also discarded to avoid misquantification of false positives arising from non-specific cilia staining. If a “potential cilium” meets these tests, each pixel that composes the cilium is noted and mapped to the matrix that holds the intensity values for the POI channel.
The POI staining, such as that for Gli2, does not always overlap with the marker used to identify cilia. Therefore, we expand the box encompassing an identified cilium by about 2.5 times to search for the POI signal. The pixels contained in this box are then mapped to the POI channel. A high-pass user-defined threshold for signal versus noise in the POI channel (defined as “PARAMS.TargetProtThreshold” in “ciliaFinder_Gli2.m”) is applied to generate a mask for the POI channel, and any group of contiguous pixels that have signal is labeled as “potential POI” and measured for area and intensity. The “potential POI” object that has the maximum intensity and the largest area is taken as the true POI signal, and the mean intensity of these pixels is calculated. A background-correction is performed by creating a background-correction matrix for the POI channel, in which the value of each pixel is equal to the average intensity in a 100x100 pixel grid around each pixel in the actual POI channel, followed by calculating the mean intensity in the background-correction matrix for the pixels that compose the true POI signal, and subtracting this mean from the mean intensity calculated for the POI signal in the actual POI channel. The final, POI intensity value and area for the POI signal for each identified cilium is recorded along with the area and length of the cilium in a CSV file. Lastly, TIFF files for the DAPI channel, cilia channel, and POI channel for each field are saved, and snapshots of the chosen cilia, the POI channel in the chosen cilia, the mask for the POI channel in the chosen cilia, and the actual POI object chosen for quantification in each chosen cilium are saved for each field.